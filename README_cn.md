# DeepSea RAG — 用户使用指南

面向科研场景的全栈 RAG 系统，支持混合检索、多轮对话、ReAct Agent、Deep Research 自动化综述、画布协作、多文档对比与知识图谱探索。

> 本文档面向**使用者**，帮助你理解系统的所有功能、使用方式和推荐场景。  
> 开发者文档请参阅 `docs/developer_guide.md`；安装部署请参阅 `install.md`。

---

## 目录

- [快速开始](#快速开始)
- [系统概览](#系统概览)
- [核心概念：数据来源边界](#核心概念数据来源边界)
- [Chat 模块详解](#chat-模块详解)
  - [基础对话与意图识别](#基础对话与意图识别)
  - [检索模式](#检索模式)
  - [搜索源配置](#搜索源配置)
  - [ReAct Agent 模式](#react-agent-模式)
  - [查询优化器](#查询优化器)
  - [全文抓取](#全文抓取)
  - [年份过滤](#年份过滤)
  - [高级检索参数](#高级检索参数)
- [Deep Research 模块详解](#deep-research-模块详解)
  - [工作流程总览](#工作流程总览)
  - [阶段一：澄清意图](#阶段一澄清意图)
  - [阶段二：确认大纲](#阶段二确认大纲)
  - [阶段三：后台执行与监控](#阶段三后台执行与监控)
  - [Deep Research 设置](#deep-research-设置)
- [画布协作](#画布协作)
- [多文档对比](#多文档对比)
- [知识图谱探索](#知识图谱探索)
- [文档入库](#文档入库)
- [命令面板](#命令面板)
- [功能对比表](#功能对比表)
- [使用场景推荐](#使用场景推荐)
- [常见问题](#常见问题)

---

## 快速开始

```bash
# 1. 启动服务
bash scripts/start.sh

# 2. 打开浏览器
# 前端：http://localhost:5173
# 后端 API 文档：http://127.0.0.1:9999/docs
```

首次使用建议：
1. 在侧边栏确认 Milvus 连接状态（绿色 = 已连接）
2. 选择一个 Collection（向量库）
3. 在输入框输入问题，按 Enter 发送

---

## 系统概览

```
┌─────────────────────────────────────────────────────────┐
│                      前端界面                            │
│  ┌──────────┐  ┌──────────────────┐  ┌───────────────┐  │
│  │  侧边栏   │  │    聊天窗口       │  │   画布面板     │  │
│  │ · 检索配置 │  │  · 普通对话       │  │  · 综述编辑    │  │
│  │ · 搜索源   │  │  · Agent 工具轨迹 │  │  · 版本快照    │  │
│  │ · Agent   │  │  · 引用卡片       │  │  · 导出        │  │
│  │ · 历史记录 │  │  · 证据摘要       │  │               │  │
│  └──────────┘  └──────────────────┘  └───────────────┘  │
│  ┌──────────────────────────────────────────────────┐    │
│  │  输入栏：⚙ 设置 | 🔭 Deep Research | 输入框 | 发送  │    │
│  └──────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

---

## 核心概念：数据来源边界

**你在侧边栏勾选的搜索源，是整个系统的"数据来源边界"。** 无论是普通 Chat、ReAct Agent 还是 Deep Research，所有检索操作都严格遵守这个边界：

```
侧边栏配置
├── Local RAG 开关 ──→ 控制是否搜索本地向量库
├── Web Search 开关 ──→ 控制是否启用网络搜索
└── 各搜索源勾选 ────→ 限定可用的网络搜索引擎
         │
         ▼
    ┌─────────────────────────────────────┐
    │  所有模式共享同一套数据来源约束       │
    │                                     │
    │  · 普通 Chat 的检索                  │
    │  · ReAct Agent 的工具箱              │
    │  · Deep Research 的每一次搜索         │
    │  · Query Optimizer 的查询生成         │
    └─────────────────────────────────────┘
```

**未勾选的搜索源永远不会被调用**，即使 Agent 自主推理时也不例外。

---

## Chat 模块详解

### 基础对话与意图识别

在输入框中输入问题，按 **Enter** 发送。系统会经过三层意图识别判断你的问题是否需要检索：

| 层级 | 机制 | 说明 |
|:----:|------|------|
| 第一层 | 正则关键词 | 消息包含"文献""对比""哪些""帮我查"等关键词 → 直接走检索（零成本） |
| 第二层 | LLM 轻量分类 | 调用 LLM 判断 `chat`（闲聊）还是 `rag`（需检索），约 300 tokens |
| 第三层 | 保守兜底 | 如果 LLM 输出无法识别 → 默认走检索（宁可多检索，不漏检） |

判定结果的影响：

| 判定 | 检索 | Agent | System Prompt |
|:----:|:----:|:-----:|:-------------:|
| **chat**（闲聊） | 跳过 | 强制关闭 | 纯对话 prompt |
| **rag**（需检索） | 执行 | 按你的开关决定 | RAG 合成 prompt |

这意味着：
- 你发"你好" → 系统识别为闲聊 → 不检索、不调 Agent、直接回答
- 你发"深海冷泉有哪些微生物" → 关键词命中"哪些" → 走检索
- 即使你开了 Agent，闲聊类问题也不会触发工具调用

### 检索模式

系统根据你的开关组合自动确定检索模式：

| Local RAG | Web Search | 实际模式 | 说明 |
|:---------:|:----------:|:--------:|------|
| ✅ | ✅ | `hybrid` | 本地向量库 + 网络搜索，结果融合去重 |
| ✅ | ❌ | `local` | 仅搜索本地向量库（Milvus） |
| ❌ | ✅ | `web` | 仅搜索网络 |
| ❌ | ❌ | `none` | 不检索，纯 LLM 对话 |

**推荐**：大多数科研场景使用 `hybrid` 模式，兼顾本地文献库和最新网络信息。

### 搜索源配置

在侧边栏 **Web Search** 区域，你可以独立开关每个搜索引擎：

| 搜索源 | 特点 | 适用场景 | 默认状态 |
|--------|------|---------|:--------:|
| **Tavily API** | 通用网络搜索，速度快，覆盖广 | 一般性问题、新闻、技术文档 | ✅ 开启 |
| **Google Search** | 通用搜索（通过 Playwright） | Tavily 不可用时的备选 | ❌ 关闭 |
| **Google Scholar** | 学术论文搜索，支持年份过滤 | 学术文献检索 | ❌ 关闭 |
| **Semantic Scholar** | 学术 API，返回结构化元数据 | 精确学术搜索（DOI/作者/摘要） | ❌ 关闭 |
| **NCBI PubMed** | 生物医学专库（E-Utilities） | 医学、生物、基因组、海洋生态 | ❌ 关闭 |

每个搜索源可独立配置 **Top-K**（从该源最多采集多少条结果，默认 3-5）。

> **关于 Web 源的 Threshold**  
> 侧边栏中 Web 搜索源**没有** Threshold 滑块。原因是各搜索引擎 API 返回的结果没有统一的相似度分数，无法做阈值过滤。Web 结果的质量控制完全依赖后续的 **ColBERT Reranker** 精排。  
> **Similarity Threshold 仅作用于本地 RAG 结果**（见下方"高级检索参数"）。

#### Web 搜索的数据流

```
你为每个源设置的 Top-K
  ↓ 每个源独立采集（并发）
  ↓ 跨源 URL 去重（保留权重高的来源版本）
  ↓ ColBERT Reranker 精排
  ↓ 与本地结果融合
  ↓ Final Top-K 截断
  → 最终送入 LLM 的证据
```

例如你开了 Tavily(Top-K=5) + Scholar(Top-K=3) + NCBI(Top-K=5)，三个源分别独立搜索 5、3、5 条结果，去重后再统一精排，最终由 Final Top-K 截断。

### ReAct Agent 模式

侧边栏 **Agent Mode** 区域的 **ReAct Agent** 开关控制 LLM 的行为方式。

#### 关闭 Agent（普通模式）

```
用户提问 → 意图识别（需要检索？）
             ├─ 否 → LLM 直接回答（纯对话）
             └─ 是 → 一次性检索（你勾选的源）→ LLM 基于结果回答
```

- 检索只执行一次
- LLM 看到检索结果后直接生成回答
- 速度快，适合简单问题

#### 开启 Agent（ReAct 模式）

```
用户提问 → 意图识别（需要检索？）
             ├─ 否 → LLM 直接回答（Agent 被跳过）
             └─ 是 → 检索（你勾选的源）→ 结果写入 System Prompt
                      → Agent 推理循环（最多 8 轮）
                           │  LLM 阅读已有证据，判断是否充足
                           │  不足时自主调用工具补充搜索
                           ├→ search_local（本地搜索）
                           ├→ search_web（Tavily/Google）
                           ├→ search_scholar（Scholar/Semantic Scholar）
                           ├→ search_ncbi（PubMed）
                           ├→ explore_graph（图谱探索）
                           ├→ compare_papers（论文对比）
                           ├→ canvas（画布操作）
                           └→ get_citations（引用管理）
```

关键细节：

- **Agent 拿到的工具是动态路由的**，不是固定的全部工具。系统根据你的搜索源勾选、消息内容和当前阶段，只挂载相关工具
- **Agent 只能调用你勾选的搜索源对应的工具**。例如你只勾了 Tavily + NCBI，Agent 就只有 `search_web` 和 `search_ncbi`，不会出现 `search_scholar`
- 第一轮检索的结果已经在 System Prompt 中，Agent 会先评估这些结果是否充足，不足时才主动发起额外搜索
- 工具调用过程在聊天窗口的 **Tool Trace** 面板实时可见

#### 工具路由映射

| 你勾选的搜索源 | Agent 获得的工具 |
|:---:|:---:|
| Tavily 和/或 Google | `search_web` |
| Google Scholar 和/或 Semantic Scholar | `search_scholar` |
| NCBI PubMed | `search_ncbi` |
| 都没勾选 | 无网络搜索工具（仅 `search_local`） |

此外，以下工具根据消息内容和阶段自动挂载（不受搜索源勾选影响）：

| 工具 | 触发条件 |
|------|---------|
| `explore_graph` | 消息提到关系、图谱、网络等关键词 |
| `compare_papers` / `run_code` | 消息提到对比、统计、代码等关键词 |
| `canvas` / `get_citations` | 当前处于 drafting/refine 阶段，或消息提到画布、引用等 |

#### 何时开启 Agent？

| 场景 | 推荐 | 原因 |
|------|:----:|------|
| 简单事实查询 | 关闭 | 一次检索足够，Agent 增加延迟 |
| 复杂多步骤问题 | **开启** | Agent 能迭代搜索、交叉验证 |
| 需要多源对比 | **开启** | Agent 能调用多个搜索引擎 |
| 需要图谱关联 | **开启** | Agent 能调用 explore_graph |
| 闲聊/翻译 | 无影响 | 意图识别会跳过检索，Agent 不会被激活 |

### 查询优化器

侧边栏 **Query Enhancement** 区域的 **Query Optimizer** 开关。

开启后，系统会用 LLM 将你的问题转化为适合不同搜索引擎的查询：

- 给 **Tavily/Google** 生成自然语言查询
- 给 **Google Scholar** 生成学术关键词组合
- 给 **NCBI PubMed** 生成 MeSH 风格医学术语
- 支持中英双语查询生成
- 每个搜索引擎最多生成 N 条查询（可配置 1-5，默认 3）
- **只为你勾选的搜索源生成查询**，不会为未勾选的源浪费 tokens

**推荐**：开启。对于学术搜索尤其有效，能显著提升召回率。

### 全文抓取

侧边栏 **Content Fetcher** 开关。

开启后，系统会对网络搜索结果的 URL 进行全文抓取，获取完整页面内容而非仅摘要。

- 三级回退：trafilatura → BrightData → Playwright
- 自动识别学术域名
- 结果缓存（1 小时）

**推荐**：默认关闭。仅在需要深度分析网页全文时开启，会增加响应时间。

### 年份过滤

在 Deep Research 设置弹窗（⚙ 按钮）中配置 **Year Window**。

- **起始年份** / **结束年份**：硬过滤，只保留该时间范围内的文献
- 应用于：Google Scholar、Semantic Scholar、NCBI PubMed、本地 RAG（如有年份元数据）
- Tavily 和 Google 不支持原生年份过滤
- 留空 = 不限制
- **Chat 和 Deep Research 共享同一套年份设置**

**推荐**：综述写作时设置合理的年份窗口（如 2015-2025），避免过时文献干扰。

### 高级检索参数

| 参数 | 位置 | 作用范围 | 说明 | 默认值 |
|------|------|---------|------|:------:|
| Local Top-K | 侧边栏 · 检索配置 | 本地 RAG | 本地向量检索返回的最大 chunk 数 | 5 |
| Similarity Threshold | 侧边栏 · 合并参数 | **仅本地 RAG** | 低于此相似度的本地 chunk 被过滤；**不作用于 Web 结果** | 0.5 |
| Final Top-K | 侧边栏 · 合并参数 | 全局（Local + Web 融合后） | 所有来源合并后最终保留的结果数 | 10 |
| 每个 Web 源的 Top-K | 侧边栏 · Web 搜索源 | 对应 Web 源 | 该源的独立采集上限，之后跨源去重 + Rerank | 3-5 |
| HippoRAG | 侧边栏 · 检索配置 | 本地 RAG | 图增强检索（基于知识图谱的 PageRank 扩展） | 关闭 |
| ColBERT Reranker | 侧边栏 · 检索配置 | Web 结果 + 本地结果 | 对检索结果做精排（ColBERT 模型） | 开启 |

#### 参数在不同模式下的生效情况

| 参数 | 普通 Chat（无 Agent） | ReAct Agent | Deep Research |
|------|:-------------------:|:-----------:|:-------------:|
| 每个 Web 源的 Top-K | ✅ 严格遵守 | ❌ Agent 工具调用使用硬编码默认值 | ✅ 严格遵守 |
| Local Top-K | ✅ 严格遵守 | ✅ 首轮检索遵守；Agent 工具调用使用默认值 | ✅ 遵守（自动放大） |
| Similarity Threshold | ✅ 严格遵守 | ✅ 首轮检索遵守；Agent 工具调用不传此参数 | ✅ 严格遵守 |
| Final Top-K | ✅ 严格遵守 | ✅ 首轮检索遵守；Agent 工具调用不传此参数 | ✅ 遵守（自动放大） |

> **Agent 模式的特殊说明**：当 ReAct Agent 自主发起额外搜索时（通过 `search_web`、`search_scholar`、`search_ncbi` 等工具），这些工具调用使用工具 schema 中的硬编码默认值（`top_k=10` 或 `limit=5`），**不会读取你在侧边栏设置的 per-source Top-K 和 Threshold**。只有首轮预检索（Agent 启动前的那次检索）才完整遵守你的配置。

---

## Deep Research 模块详解

Deep Research 是系统的核心功能，能从选题到综述终稿完成全自动化研究流程。

**Deep Research 同样严格遵守你的数据来源配置**——它的每一次搜索（scope、plan、research、write、verify）都只使用你勾选的搜索源。

### 工作流程总览

```
输入主题 → 澄清意图 → 生成大纲 → 确认配置 → 后台执行 → 综述完成
           Phase 1      Phase 2     Phase 2     Phase 3
```

后台执行的内部流程：

```
Scope（定义范围）
  → Plan（规划大纲）
    → Research（逐章递归搜索）    ← 使用你勾选的搜索源
      → Evaluate（覆盖率评估）
        → Write（逐章撰写）       ← 使用你勾选的搜索源获取写作证据
          → Verify（引用验证）     ← 使用你勾选的搜索源做验证检索
            → Synthesize（全文整合）
```

### 启动方式

有三种方式启动 Deep Research：

1. **输入框左侧的 🔭 Deep Research 按钮**：输入主题后点击
2. **命令面板**：输入 `/auto 你的研究主题`
3. **⚙ 设置按钮**：先配置默认参数，再启动

### 阶段一：澄清意图

系统会根据你的主题生成 2-5 个澄清问题，帮助明确研究范围：

- 问题类型包括：文本输入、单选、多选
- 可以跳过不回答（系统会用默认值）
- 回答越详细，后续研究越精准

点击 **"生成大纲"** 进入下一阶段。

### 阶段二：确认大纲

系统生成研究大纲后，你可以：

| 操作 | 说明 |
|------|------|
| **编辑章节标题** | 直接修改文本 |
| **拖拽排序** | 拖动左侧图标调整顺序 |
| **添加/删除章节** | 点击 + 或垃圾桶图标 |
| **选择研究深度** | Lite（5-15 分钟）或 Comprehensive（20-60 分钟） |
| **配置输出语言** | Auto / English / 中文 |
| **覆盖分步模型** | 为不同阶段指定不同 LLM |
| **设置人工介入** | 选择哪些阶段需要人工审核 |
| **补充上下文** | 文本输入或上传临时材料（pdf/md/txt） |

#### 研究深度对比

| 维度 | Lite | Comprehensive |
|------|------|---------------|
| 预计耗时 | 5-15 分钟 | 20-60 分钟 |
| 每章查询数 | 4 条（召回+精确） | 8 条（召回+精确） |
| Top-K 分层 | 18 / 10 / 10 | 30 / 15 / 12 |
| 覆盖率阈值 | ≥ 60% | ≥ 80% |
| 适用场景 | 快速调研、初步了解 | 正式综述、学术写作 |

#### 人工介入选项

| 阶段 | 说明 | 默认 |
|------|------|:----:|
| 澄清意图 | 回答澄清问题 | 必须 |
| 确认大纲 | 编辑大纲后确认 | 必须 |
| 逐章审阅 | 每章写完后审核/修改 | 可选 |
| 精炼修改 | 全文整合前给出修改指令 | 可选 |
| 跳过论点提炼 | 跳过写作前的核心论点提取 | 可选 |

点击 **"确认并开始研究"** 进入执行阶段。

### 阶段三：后台执行与监控

任务提交后转入后台执行，你可以：

- **安全关闭浏览器**：任务在服务器持续运行
- **重新打开页面**：自动恢复任务状态
- **实时监控**：进度日志、覆盖率曲线、成本状态
- **取消任务**：点击停止按钮

监控面板显示：

| 指标 | 说明 |
|------|------|
| 覆盖率 | 每章的证据覆盖率（0-1） |
| 研究轮次 | 每章的搜索迭代次数 |
| 成本状态 | normal → warn → force（强制摘要） |
| 自我修正次数 | 搜索策略自动调整次数 |
| 早停次数 | 覆盖率增益平坦时的自动终止 |

完成后，综述会自动写入画布，包含：
- 完整综述正文（带引用标注）
- Abstract
- Limitations
- Open Gaps 研究议程
- 引用列表

### Deep Research 设置

通过输入框左侧的 **⚙ 按钮** 打开设置弹窗，配置跨会话持久化：

| 设置项 | 说明 | 默认值 |
|--------|------|:------:|
| Research Depth | 研究深度 | Comprehensive |
| Output Language | 输出语言 | Auto |
| Year Window | 年份过滤（Chat 和 Deep Research 共享） | 不限 |
| Per-step Models | 分步骤模型 | scope=sonar-pro，其余=全局模型 |
| Strict Mode | 模型失败时是否中止 | 关闭 |
| Skip Claim Generation | 跳过论点提炼 | 关闭 |

---

## 画布协作

画布是综述编辑的核心工作区，支持四个阶段：

| 阶段 | 功能 |
|------|------|
| **Explore** | 浏览检索到的证据和来源 |
| **Outline** | 编辑综述大纲结构 |
| **Drafting** | 逐章撰写和编辑 |
| **Refine** | 全文精炼、注释、最终调整 |

支持的操作：
- Markdown 实时编辑
- 版本快照（最多 50 个版本）
- AI 辅助段落编辑
- 引用管理与格式化
- 导出：Markdown / DOCX / RIS（引用）/ JSON

---

## 多文档对比

选择 2-5 篇论文进行结构化对比：

1. 在聊天中产生引用后，切换到 **Compare** 标签页
2. 从对话引文或本地文库中选择论文
3. 系统生成对比矩阵：目标、方法、发现、局限性
4. 附带叙述性分析

---

## 知识图谱探索

切换到 **Graph** 标签页：

- 搜索实体（物种、地点、现象、方法、物质等）
- 力导向图可视化
- 控制探索深度（跳数）
- 点击节点查看详情和关联 chunk
- 不同实体类型用不同颜色标识

---

## 文档入库

切换到 **Ingest** 标签页：

1. 上传 PDF 文件（支持批量）
2. 选择目标 Collection
3. 可选：启用表格/图片增强
4. 系统自动完成：PDF 解析 → 结构化切块 → 向量嵌入 → Milvus 入库 → 图谱构建
5. 实时查看入库进度

---

## 命令面板

在输入框中输入 `/` 可唤出命令面板：

| 命令 | 功能 | 示例 |
|------|------|------|
| `/auto` | 启动 Deep Research | `/auto 深海冷泉甲烷氧化` |
| `/search` | 执行检索 | `/search cold seep ecosystem` |
| `/outline` | 生成大纲 | `/outline` |
| `/draft` | 起草章节 | `/draft introduction` |
| `/export` | 导出文档 | `/export` |
| `/status` | 查看系统状态 | `/status` |

---

## 功能对比表

### Chat 普通模式 vs ReAct Agent vs Deep Research

| 维度 | 普通 Chat | ReAct Agent | Deep Research |
|------|:---------:|:-----------:|:-------------:|
| 数据来源 | 你勾选的源 | 你勾选的源 | 你勾选的源 |
| 检索次数 | 1 次 | 1 次 + Agent 按需补充（最多 8 轮） | 数十次（逐章递归） |
| 搜索词 | 系统生成 1 组 | 首轮系统生成 + Agent 自主补充 | 查询优化器批量生成 |
| 工具调用 | 无 | 动态路由（按你的配置和消息内容挂载） | 内置完整研究流水线 |
| 输出长度 | 几百字 | 几百到上千字 | 数千到上万字（完整综述） |
| 耗时 | 5-30 秒 | 10-60 秒 | 5-60 分钟 |
| 人工介入 | 无 | 无 | 可选（澄清/大纲/审阅） |
| 引用管理 | 基础引用 | 基础引用 | 完整引用 + 验证 + 保护 |
| 画布集成 | 可选 | 可选 | 自动写入画布 |
| 后台运行 | 否 | 否 | 是 |
| 意图识别 | 自动（闲聊跳过检索） | 自动（闲聊时 Agent 不激活） | 不适用（始终执行） |
| 适用场景 | 快速问答 | 复杂多步问题 | 综述写作 |

### 搜索源对比

| 搜索源 | 类型 | 速度 | 学术性 | 原生年份过滤 | 最佳场景 |
|--------|:----:|:----:|:------:|:--------:|---------|
| Tavily | 通用 | ★★★ | ★☆☆ | ❌ | 一般性问题、技术文档 |
| Google | 通用 | ★★☆ | ★☆☆ | ❌ | Tavily 备选 |
| Google Scholar | 学术 | ★★☆ | ★★★ | ✅ | 学术文献广泛检索 |
| Semantic Scholar | 学术 | ★★★ | ★★★ | ✅ | 精确学术搜索（有 DOI） |
| NCBI PubMed | 专业 | ★★★ | ★★★ | ✅ | 生物医学、基因组、海洋生态 |

### 检索增强功能对比

| 功能 | 作用 | 开启代价 | 推荐 |
|------|------|---------|:----:|
| Query Optimizer | 为你勾选的搜索引擎优化查询格式 | +2-5 秒 | ✅ |
| Content Fetcher | 抓取网页全文 | +5-15 秒 | 按需 |
| HippoRAG | 图增强检索（PageRank 扩展） | +1-3 秒 | 按需 |
| ColBERT Reranker | 精排检索结果 | +1-2 秒 | ✅ |

---

## 使用场景推荐

### 场景 1：快速文献问答

> "冷泉生态系统中甲烷厌氧氧化的主要微生物有哪些？"

**推荐配置**：
- Local RAG: ✅ | Web Search: ✅
- 搜索源: Tavily + NCBI PubMed
- Agent: 关闭
- Query Optimizer: ✅

**原因**：简单事实查询，一次检索足够。NCBI 能精准命中生物医学文献。

---

### 场景 2：多源交叉验证

> "比较不同研究对深海热液喷口微生物多样性的发现"

**推荐配置**：
- Local RAG: ✅ | Web Search: ✅
- 搜索源: Tavily + Google Scholar + Semantic Scholar + NCBI
- Agent: **开启**
- Query Optimizer: ✅

**原因**：需要多源对比，Agent 能在首轮检索基础上自主补充搜索并交叉验证。

---

### 场景 3：综述写作

> "写一篇关于深海冷泉生态系统碳循环的综述"

**推荐配置**：
- 使用 **Deep Research**（`/auto` 命令）
- 深度: Comprehensive
- 搜索源: 全部开启
- 年份: 2015-2025
- 人工介入: 开启逐章审阅

**原因**：综述需要系统性文献调研，Deep Research 能自动完成从选题到终稿的全流程。

---

### 场景 4：快速调研

> "了解一下 CRISPR 在海洋微生物中的应用现状"

**推荐配置**：
- 使用 **Deep Research**（`/auto` 命令）
- 深度: **Lite**
- 搜索源: NCBI + Google Scholar
- 人工介入: 最小化

**原因**：Lite 模式 5-15 分钟出结果，适合快速了解一个领域。

---

### 场景 5：纯对话（不需要检索）

> "帮我翻译这段摘要" / "解释一下 p-value 的含义"

**推荐配置**：
- 无需调整任何配置
- 系统自动识别为闲聊，跳过检索和 Agent

**原因**：三层意图识别会自动判断，闲聊/翻译/概念解释不触发检索。

---

### 场景 6：知识图谱探索

> "探索 '甲烷氧化古菌' 与其他实体的关联"

**推荐配置**：
- 切换到 **Graph** 标签页
- 搜索实体关键词
- 调整探索深度

**原因**：图谱可视化能直观展示实体间的关联关系。

---

## 常见问题

**Q: Agent 模式或 Deep Research 会使用我没有勾选的搜索源吗？**  
A: 不会。你在侧边栏勾选的搜索源是整个系统的"数据来源边界"，普通 Chat、ReAct Agent、Deep Research 都严格遵守。

**Q: Deep Research 执行中可以关闭浏览器吗？**  
A: 可以。任务在服务器后台运行，重新打开页面会自动恢复状态。

**Q: Agent 开启后，它拿到的工具是固定的吗？**  
A: 不是。系统会根据你的搜索源勾选、消息内容和当前阶段动态路由，只挂载相关工具。例如你没勾 NCBI，Agent 就不会拿到 `search_ncbi` 工具。

**Q: 为什么有时候 Agent 不调用任何工具？**  
A: 系统有三层意图识别。如果判定你的问题是闲聊类，即使开了 Agent 也会跳过工具调用，直接用纯对话模式回答。

**Q: Query Optimizer 只为我勾选的源生成查询吗？**  
A: 是的。它不会为未勾选的搜索源浪费 tokens 生成查询。

**Q: NCBI PubMed 需要 API Key 吗？**  
A: 不需要（默认 3 请求/秒）。如果配置了 API Key，速率提升到 10 请求/秒。

**Q: 如何选择 Lite 还是 Comprehensive？**  
A: 快速了解用 Lite（5-15 分钟），正式写作用 Comprehensive（20-60 分钟）。

**Q: 年份过滤对 Tavily 和 Google 有效吗？**  
A: Tavily 和 Google 不支持原生年份过滤。年份过滤主要作用于 Google Scholar、Semantic Scholar、NCBI PubMed 和本地 RAG。

---

*最后更新：2026-02-19*
